import { Controller } from "@nestjs/common";
import { TypedRoute, TypedBody, TypedParam } from "@nestia/core";
import typia, { tags } from "typia";
import { post__discussionBoard_admin_moderationActions } from "../../../../providers/post__discussionBoard_admin_moderationActions";
import { AdminAuth } from "../../../../decorators/AdminAuth";
import { AdminPayload } from "../../../../decorators/payload/AdminPayload";
import { put__discussionBoard_admin_moderationActions_$moderationActionId } from "../../../../providers/put__discussionBoard_admin_moderationActions_$moderationActionId";
import { delete__discussionBoard_admin_moderationActions_$moderationActionId } from "../../../../providers/delete__discussionBoard_admin_moderationActions_$moderationActionId";

import { IDiscussionBoardModerationAction } from "../../../../api/structures/IDiscussionBoardModerationAction";

@Controller("/discussionBoard/admin/moderationActions")
export class DiscussionboardAdminModerationactionsController {
  /**
   * Create a new moderation action (warn, remove, restrict, etc.) by a
   * moderator or admin.
   *
   * Create a new moderation action record to log activity performed by
   * moderators or admins for enforcement of platform policies. This includes
   * actions against users, posts, or commentsâ€”such as warning, restricting,
   * muting, removing, or restoring content. The API requires identifying the
   * acting moderator, the target (user, post, or comment), specifying the type
   * of moderation action (e.g., warn, mute, remove, restore), the reason for
   * the action, and relevant effective timing. All actions are recorded in the
   * moderation_actions schema for audit and compliance.
   *
   * Security is ensured by restricting this endpoint to users with moderator or
   * admin roles; each action taken is logged and auditable. Linked records must
   * exist in the target tables (users, posts, or comments). Business logic will
   * validate action-specific requirements (such as only allowing restore
   * actions on content previously removed), and rejection reasons are clearly
   * reported.
   *
   * Expected behavior includes auditing/traceability and propagation of
   * moderation effects to related user/content state. This endpoint upholds
   * community integrity, enables regulatory compliance, and is a primary
   * interface for staff moderation activities.
   *
   * @param connection
   * @param body Information about the moderation action to record, including
   *   action type, target, reason, and timing.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Post()
  public async create(
    @AdminAuth()
    admin: AdminPayload,
    @TypedBody()
    body: IDiscussionBoardModerationAction.ICreate,
  ): Promise<IDiscussionBoardModerationAction> {
    try {
      return await post__discussionBoard_admin_moderationActions({
        admin,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Update an existing moderation action record (e.g., restriction
   * reason/time).
   *
   * Update (modify) an existing moderation action. This endpoint allows
   * moderators or admins to change the moderation action parameters, such as
   * action type, affected user/post/comment, reason, or restriction timeframe.
   * Changes are fully audited and tracked in the database to preserve
   * historical state and regulatory compliance.
   *
   * This operation ensures consistency and traceability for all moderation
   * enforcement history. Security is strict, with access limited to users
   * having moderator or admin roles. The operation checks existence of the
   * moderation action and validates appropriate permissions on both the action
   * and the affected target.
   *
   * All updates are logged for compliance, with business validation on which
   * fields may be changed post-creation, and responses include updated
   * moderation action records.
   *
   * @param connection
   * @param moderationActionId Unique identifier for the target moderation
   *   action to update.
   * @param body Updates to apply to the moderation action, such as reason,
   *   type, timing, or affected entity.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Put(":moderationActionId")
  public async update(
    @AdminAuth()
    admin: AdminPayload,
    @TypedParam("moderationActionId")
    moderationActionId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IDiscussionBoardModerationAction.IUpdate,
  ): Promise<IDiscussionBoardModerationAction> {
    try {
      return await put__discussionBoard_admin_moderationActions_$moderationActionId(
        {
          admin,
          moderationActionId,
          body,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Soft delete (retire) a moderation action for audit compliance.
   *
   * Soft delete (retire) a specific moderation action, setting its deleted_at
   * timestamp for logical deletion and audit compliance. The record remains
   * visible in audits but not returned in regular API queries. Only moderators
   * or admins can perform this function; the API enforces permissions and
   * validates action existence. Soft-deleted moderation actions cannot be
   * enforced and are treated as obsolete in business workflows.
   *
   * Every record soft-deleted here is auditable and traceable. Attempting to
   * delete a non-existent or already retired moderation action will result in a
   * clear error. Soft deletion supports legal compliance, as all moderation
   * changes remain discoverable in case of investigation.
   *
   * @param connection
   * @param moderationActionId Unique ID of the moderation action to soft
   *   delete.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Delete(":moderationActionId")
  public async erase(
    @AdminAuth()
    admin: AdminPayload,
    @TypedParam("moderationActionId")
    moderationActionId: string & tags.Format<"uuid">,
  ): Promise<IDiscussionBoardModerationAction> {
    try {
      return await delete__discussionBoard_admin_moderationActions_$moderationActionId(
        {
          admin,
          moderationActionId,
        },
      );
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
